files:
   "/etc/cron.d/mycron":
      mode: "000644"
      owner: root
      group: root
      content: |
         */1 * * * * root /usr/local/bin/esmonitor.sh

   "/usr/local/bin/esmonitor.sh":
      mode: "000755"
      owner: root
      group: root
      content: |
         #!/bin/bash

         if ! ps -ef | grep -v grep | grep "esimport sync account" ; then
            /usr/local/bin/esimport sync account &>> /var/log/esimport/account.log &
         fi

         if ! ps -ef | grep -v grep | grep "esimport sync session" ; then
            /usr/local/bin/esimport sync session --start-date 2018-05-01 &>> /var/log/esimport/session.log &
         fi

         if ! ps -ef | grep -v grep | grep "esimport sync device" ; then
            /usr/local/bin/esimport sync device --start-date 2018-05-01 &>> /var/log/esimport/device.log &
         fi

          if ! ps -ef | grep -v grep | grep "esimport update conference" ; then
            /usr/local/bin/esimport update conference --start-date 2017-04-30 &>> /var/log/esimport/conference.log &
         fi

         if ! ps -ef | grep -v grep | grep "esimport update property" ; then
            /usr/local/bin/esimport update property &>> /var/log/esimport/property.log &
         fi

         if ! ps -ef | grep -v grep | grep "esimport esdatacheck account" ; then
            /usr/local/bin/esimport esdatacheck account &>> /var/log/esimport/esdatacheck_account.log &
         fi

         if ! ps -ef | grep -v grep | grep "esimport esdatacheck conference" ; then
            /usr/local/bin/esimport esdatacheck conference &>> /var/log/esimport/esdatacheck_conference.log &
         fi

         if ! ps -ef | grep -v grep | grep "esimport esdatacheck device" ; then
            /usr/local/bin/esimport esdatacheck device &>> /var/log/esimport/esdatacheck_device.log &
         fi

         if ! ps -ef | grep -v grep | grep "esimport esdatacheck property" ; then
            /usr/local/bin/esimport esdatacheck property &>> /var/log/esimport/esdatacheck_property.log &
         fi

         if ! ps -ef | grep -v grep | grep "esimport esdatacheck session" ; then
            /usr/local/bin/esimport esdatacheck session &>> /var/log/esimport/esdatacheck_session.log &
         fi

         exit 0

commands:
   remove_old_cron:
      command: "rm -f /etc/cron.d/*.bak"